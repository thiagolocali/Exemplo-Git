
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/images/favicon.ico">
    <title>SubCategorias - TESTE2</title>

    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/icons.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/style.css" rel="stylesheet" type="text/css">
    <link href="/assets/css/DataTable/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <script src="/assets/js/jquery-3.3.1.js"></script>
    <script src="/assets/js/DataTable/jquery.dataTables.min.js"></script>
    <script src="/assets/js/DataTable/dataTables.bootstrap4.min.js"></script>
    <script src="/assets/js/modernizr.min.js"></script>

    <script src="/assets/js/Comum/Componentes/FileUpload.js"></script>
    <script src="/assets/js/Comum/Componentes/CriarElementos.js"></script>
    <script src="/assets/js/Comum/Grid/Gerar.js"></script>
    <script src="/assets/js/Comum/Grid/Reload.js"></script>
    <script src="/assets/js/Comum/Grid/SelecionarLinha.js"></script>
    <script src="/assets/js/Comum/Modal/Salvar.js"></script>
    <script src="/assets/js/Comum/Modal/Validacao.js"></script>
    <script src="/assets/js/Comum/Modal/Interfaces.js"></script>
    <script src="/assets/js/Comum/Util/Acao.js"></script>
    <script src="/assets/js/Comum/Util/Ambiente.js"></script>
    <script src="/assets/js/Comum/Util/Convert.js"></script>
    <script src="/assets/js/Comum/Util/Erro.js"></script>
    <script src="/assets/js/Comum/Util/Mascara.js"></script>
    <script src="/assets/js/Comum/Util/Valida.js"></script>
    <script src="/assets/js/Comum/Util/DateFormat.js"></script>
    <script src="/assets/js/Comum/Util/Mensagem.js"></script>
    <script src="/assets/js/Comum/Util/Erro.js"></script>
    <script src="/assets/js/Comum/Util/Logoff.js"></script>
    <script src="/assets/js/Plugin/notifications/notify-metro.js"></script>
    <script src="/assets/js/Plugin/notifications/notify.min.js"></script>
</head>
<body class="fixed-left">
    <div id="load" class="fundoLoad">
    <div class="centerLoad">
        <div class="loader"></div>
    </div>
</div>


<style>
    .centerLoad {
        position: absolute;
        top: 40%;
        left: 45%;
        z-index: 3001;
    }

    .fundoLoad {
        display:none;
        top: 0;
        position: fixed;
        width: 100%;
        height: 100%;
        z-index: 3000;
    }
</style>


    <div id="wrapper">
        <div class="topbar">
            <div class="topbar-left">
    <div class="text-center"><br />
        <img src="/assets/images/tl/cubo.fw.png" />
    </div>
</div>
            <nav class="navbar-custom">
                <ul class="list-inline float-right mb-0">
                    <li class="list-inline-item notification-list hide-phone">
    <a class="nav-link waves-light waves-effect" href="#" id="btn-fullscreen">
        <i class="mdi mdi-crop-free noti-icon"></i>
    </a>
</li>
                    <li style="display:none;" class="list-inline-item dropdown notification-list">
    <a class="nav-link dropdown-toggle arrow-none waves-light waves-effect" data-toggle="dropdown" href="#" role="button"
       aria-haspopup="false" aria-expanded="false">
        <i class="mdi mdi-bell noti-icon"></i>
        <span class="badge badge-pink noti-icon-badge">4</span>
    </a>
    <div class="dropdown-menu dropdown-menu-right dropdown-arrow dropdown-menu-lg" aria-labelledby="Preview">
        <!-- item-->
        <div class="dropdown-item noti-title">
            <h5 class="font-16"><span class="badge badge-danger float-right">5</span>Notification</h5>
        </div>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <div class="notify-icon bg-success"><i class="mdi mdi-comment-account"></i></div>
            <p class="notify-details">Robert S. Taylor commented on Admin<small class="text-muted">1 min ago</small></p>
        </a>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <div class="notify-icon bg-info"><i class="mdi mdi-account"></i></div>
            <p class="notify-details">New user registered.<small class="text-muted">1 min ago</small></p>
        </a>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <div class="notify-icon bg-danger"><i class="mdi mdi-airplane"></i></div>
            <p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">1 min ago</small></p>
        </a>
        <!-- All-->
        <a href="javascript:void(0);" class="dropdown-item notify-item notify-all">
            View All
        </a>
    </div>
</li>
                    <li style="display:none;" class="list-inline-item dropdown notification-list">
    <a class="nav-link dropdown-toggle waves-effect waves-light nav-user" data-toggle="dropdown" href="#" role="button"
       aria-haspopup="false" aria-expanded="false">
        <img src="/assets/images/users/avatar-1.jpg" alt="user" class="rounded-circle">
    </a>
    <div class="dropdown-menu dropdown-menu-right profile-dropdown " aria-labelledby="Preview">
        <!-- item-->
        <div class="dropdown-item noti-title">
            <h5 class="text-overflow"><small>Welcome ! John</small> </h5>
        </div>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <i class="mdi mdi-account"></i> <span>Profile</span>
        </a>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <i class="mdi mdi-settings"></i> <span>Settings</span>
        </a>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <i class="mdi mdi-lock-open"></i> <span>Lock Screen</span>
        </a>
        <!-- item-->
        <a href="javascript:void(0);" class="dropdown-item notify-item">
            <i class="mdi mdi-logout"></i> <span>Logout</span>
        </a>
    </div>
</li>
                </ul>
                <ul class="list-inline menu-left mb-0">
                    <li class="float-left">
                        <button class="button-menu-mobile open-left waves-light waves-effect">
                            <i class="mdi mdi-menu"></i>
                        </button>
                    </li>

                    <li style="display:none;" class="hide-phone app-search">
    <form role="search" class="">
        <input type="text" placeholder="Search..." class="form-control">
        <a href="#"><i class="fa fa-search"></i></a>
    </form>
</li>
                </ul>
            </nav>
        </div>

        <div class="left side-menu">
    <div class="sidebar-inner slimscrollleft">
        <div id="sidebar-menu">
            <ul>

                <li>
                    <a href="Categoria" class="waves-effect waves-primary">
                        <i class="ti-file"></i><span> Categorias </span>
                    </a>
                </li>
                <li style="display:none;" class="has_sub">
                    <a href="javascript:void(0);" class="waves-effect waves-primary">
                        <i class="ti-shine"></i><span> Informações </span>
                    </a>
                    <ul class="list-unstyled">
                        <li><a href="apps-kanban.html">Dados Pessoais</a></li>
                        <li><a href="apps-companies.html">Domínio</a></li>
                    </ul>
                </li>
                <li style="display:none;">
                    <a href="Cliente" class="waves-effect waves-primary">
                        <i class="ti-home"></i><span> Clientes *</span>
                    </a>
                </li>
                <li style="display:none;">
                    <a href="Clientes" class="waves-effect waves-primary">
                        <i class="ti-home"></i><span> Editor de Textos *</span>
                    </a>
                </li>
                <li >
                    <a onclick="Logoff()" class="waves-effect waves-primary">
                        <i class="ti-home"></i><span> Sair</span>
                    </a>
                </li>
            </ul>

            <div class="clearfix"></div>
        </div>
        <div class="clearfix"></div>
    </div>
</div>

        <div class="content-page">
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
    <div class="col-sm-12">
        <div class="page-title-box">
            <div class="clearfix"></div>
        </div>
    </div>
</div>
                    <div class="row">
    <div class="col-12">
        <div class="card-box">
            <div class="panel-body">
                <div class="clearfix">
                    <div class="pull-left">
                        <label style="font-size:12px;">Anterior</label>
                        <h3 id="hlPai" class="text-right">Sub Categoria</h3>
                    </div>
                </div>
                <hr />
                <div class="row">
                    <div class="col-12">
                        <div id="GridEdit" style="margin:1%;">
                        </div>
                        <div class="form-group row">
                            <table id="GridSubs" class="table table-hover m-0 table-centered dt-responsive nowrap dataTable no-footer dtr-inline collapsed" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Titulo</th>
                                        <th>Descricao</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .ImageModal {
        background-color: #ff0000;
        width: 89%;
        height: 290px;
        margin: 5%;
        border: solid #000000 3px;
    }
</style>
<script>

    $(document).ready(function () {

        var categoria = localStorage.getItem("categoria");

        var ref = getParam('ref');

        if (ref == undefined || ref == '') {
            ref = 0;
        }

        data = [
            { data: "Titulo" },
            { data: "Descricao" },
        ];

        CreateGrid('Sub/Obter/' + ref + '/' + categoria, 'GridSubs', data, true, false)

        $("#GridEdit").append(' <button id="SubCategoriaLink" type="button" class="btn btn-outline-default" disabled="disabled"><i class="fa fa-trash"></i> Sub-Categoria</button>');

        $('#SubCategoriaLink').click(function () {
            var result = table.row('.selected').data();

             document.location.href = '/Home/SubCategoria?ref=' + result.Id;
        });

        CarregarReferencia()
    });


    function CarregarReferencia() {
        var categoria = localStorage.getItem("categoria");

        var ref = getParam('ref');

        if (ref == undefined || ref == '') {
            ref = 0;
        }

        if (ref == 0) {
            $('#hlPai').html('<a href="/Home/Categoria">' + localStorage.getItem("nomeCategoria") + '</a>');
        }
        else {
            var response = Get('Sub/ObterReferencia/' + ref + '/' + categoria);
            $('#hlPai').html('<a href="/Home/SubCategoria?ref=' + response.data.Referencia + '">' + response.data.Titulo + '</a>');
        }

    }

    function CreateBodyModalCliente() {
        var body = '';
        body += CreateElementModal('hidden', '', 'Id');
        body += CreateElementModal('text', 'Titulo', 'Titulo', true, true);
        body += CreateElementModal('text', 'Descricao', 'Descricao', true, true);
        body += CreateElementModal('file', '', 'fileUp');
        SalvarModal(body);
    }

    function CorpoModalAlteracao() {
        var body = '';
        body += CreateElementModal('hidden', '', 'Id');
        body += CreateElementModal('text', 'Titulo', 'Titulo', true, true);
        body += CreateElementModal('text', 'Descricao', 'Descricao', true, true);
        body += '<input type="file" id="fileUp" onchange="FileUpload();" />';
        body += '<input type="hidden" id="files" />';
        body += '<div class="divTeste"><img id="imgAlteracao" class="ImageModal" /></di>';

        SalvarModal(body);
    }

    function ModalInsert() {

        CreateBodyModalCliente();
        $('#Id').val(result.Id);
        $('#Titulo').val(result.Titulo);
        $('#Descricao').val(result.Descricao);
    }

    function ModalUpdate() {
        var result = table.row('.selected').data();

        var diretorio = AmbienteUrl() + '/uploads/' + localStorage.getItem("cliente") + '/' + result.TituloMidia;

        CorpoModalAlteracao();
        $('#Id').val(result.Id);
        $('#Titulo').val(result.Titulo);
        $('#Descricao').val(result.Descricao);
        $("#imgAlteracao").attr("src", diretorio);

        if (result.TituloMidia == undefined) {
            document.getElementById('imgAlteracao').style.display = 'none';
        }
    }



    
    function RetornarFilesUpload(fileUpl) {
        var arquivos = fileUpl.files;

        console.log('!!!');

        console.log('arquivos', arquivos);

        for (var i = 0; i < arquivos.length; i++) {
            var fileReader = new FileReader();
            fileReader.onload = function (fileLoadedEvent) {

                console.log('fileReader', fileReader.result);

                //var srcData = fileLoadedEvent.target.result;
                //var newImage = document.createElement('img');
                //newImage.src = srcData;

                //var base64 = newImage.outerHTML.replace('">', '').split(',');
                //document.getElementById("files").value += base64[1] + ',';
                //console.log('arquivo --> ', base64[1]);
            };
            fileReader.readAsDataURL(arquivos.item(i));
        }
    }



    function Inserir(arquivos) {

        var ref = getParam('ref');

        if (ref == undefined) {
            ref = 0;
        }

        var categoria = localStorage.getItem("categoria");


        //var qtdStram = entity.Midias.length;
        //var qtdFileUpload = document.getElementById("fileUp").files.length;

        var xxx = RetornarFilesUpload(document.getElementById("fileUp"));


       
        var entity =
        {
            "Titulo": $('#Titulo').val(),
            "Descricao": $('#Descricao').val(),
            "Referencia": ref,
            "IdCategoria": categoria,
            "Midias": arquivos,
        };


       

        //console.log('1 ->', document.getElementById("fileUp").files);
        //console.log('2 ->', document.getElementById("files").value);
        //console.log('3 ->', entity.Midias);

        //if (qtdStram == qtdFileUpload) {
        //    ActionAjax('Sub/Inserir', entity, 'insert');
        //}
    }

    function Alterar(arquivos) {

        var arquivo = arquivos[0] == undefined ? "" : arquivos[0];

        var ref = getParam('ref');

        if (ref == undefined) {
            ref = 0;
        }

        var categoria = localStorage.getItem("categoria");

        var entity =
        {
            "IdSub": $('#Id').val(),
            "Referencia": ref,
            "IdCategoria": categoria,
            "Midia": arquivo,
            "Descricao": $('#Descricao').val(),
            "Titulo": $('#Titulo').val()
        };

        ActionAjax('Sub/Alterar', entity, 'update');
    }

    function Salvar() {

        var res = validate(); if (res == false) { return false; }

        var arquivos = document.getElementById("files")
            .value
            .split(',')
            .slice(0, -1);


        var existe = $('#Id').val();

        if (existe == false) {
            Inserir(arquivos)
        } else {
            Alterar(arquivos)
        }
    }

    function Delete() {
        var categoria = localStorage.getItem("categoria");

        var result = table.row('.selected').data();

        var ref = getParam('ref');

        var entity =
        {
            IdCategoria: parseInt(categoria),
            Id: parseInt(result.Id),
            Referencia: parseInt(ref),
        };

        ActionAjax('Sub/Excluir', entity, 'delete');
    }
</script>
                </div>
            </div>
        </div>

        <footer class="footer">
            

        </footer>
    </div>
    <script>
        var resizefunc = [];
    </script>
    <script src="/assets/js/Comum/Util/QueryString.js"></script>

    <!-- Popper for Bootstrap -->
    <script src="/assets/js/popper.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/detect.js"></script>
    <script src="/assets/js/fastclick.js"></script>
    <script src="/assets/js/jquery.slimscroll.js"></script>
    <script src="/assets/js/jquery.blockUI.js"></script>
    <script src="/assets/js/waves.js"></script>
    <script src="/assets/js/wow.min.js"></script>
    <script src="/assets/js/jquery.nicescroll.js"></script>
    <script src="/assets/js/jquery.scrollTo.min.js"></script>
    <!-- Custom main Js -->
    <script src="/assets/js/jquery.core.js"></script>
    <script src="/assets/js/jquery.app.js"></script>
    <div class="modal fade" id="GenericModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <form action="#">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">&nbsp;</h4>
                </div>
                <div class="modal-body">
                    <div id="modalBody">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btnConfirmar" style="display:none;" class="btn btn-outline-success">Confirmar</button>
                    <button type="button" id="btnSalvar" style="display:none;" class="btn btn-outline-success">
                        Salvar
                    </button>
                    <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </form>
</div>
    
</body>
</html>